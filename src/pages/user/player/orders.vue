<template>
  <div class="orders-page">
    <h1>📦 Đơn hàng của bạn</h1>

    <div v-if="orders.length">
      <div v-for="order in orders" :key="order.id" class="order-card">
        <h3>🧾 Đơn hàng #{{ order.id }}</h3>
        <p><b>Người nhận:</b> {{ order.name }}</p>
        <p><b>SĐT:</b> {{ order.phone }}</p>
        <p><b>Địa chỉ:</b> {{ order.address }}</p>
        <p><b>Ngày đặt:</b> {{ order.date }}</p>
        <p><b>Tổng tiền:</b> {{ order.total.toLocaleString() }}₫</p>

        <details>
          <summary>📋 Chi tiết sản phẩm</summary>
          <ul>
            <li v-for="item in order.cart" :key="item._id" style="margin-bottom: 10px;">
              <img
                v-if="item.anhMinhHoa"
                :src="getImageUrl(item.anhMinhHoa)"
                alt="Ảnh quà"
                style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; margin-right: 8px;"
              />
              {{ item.tenQuaLuuNiem }} × {{ item.quantity }} — 
              {{ (item.gia * item.quantity).toLocaleString() }}₫
            </li>
          </ul>
        </details>
      </div>
    </div>

    <p v-else>Bạn chưa có đơn hàng nào.</p>
  </div>
</template>

<script>
export default {
  name: "OrdersPage",
  data() {
    const user = JSON.parse(localStorage.getItem("user"));
    const username = user?.tenDangNhap || "guest";
    return {
      username,
      orders: JSON.parse(localStorage.getItem(`orders_${username}`)) || [],
    };
  },
  methods: {
    getImageUrl(path) {
      if (!path) return "";
      if (path.startsWith("http")) return path;
      return `http://localhost:5000/${path.replace(/^src\//, "")}`;
    },
  },
};
</script>

<style scoped>
.orders-page {
  background: linear-gradient(135deg, #42275a, #734b6d);
  color: white;
  padding: 40px;
  min-height: 100vh;
}
.order-card {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(12px);
  padding: 20px;
  border-radius: 15px;
  margin-bottom: 20px;
}
</style>
